(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3666],{35883:function(){},34776:function(e,t,n){"use strict";n.d(t,{Z:function(){return ConnectBtn}});var a=n(57437),s=n(14701),r=n(1044);function ConnectBtn(){let e=(0,r.Z)(1024);return(0,a.jsx)(s.NL,{chainStatus:e.width>600?"full":"icon",showBalance:!1})}},93390:function(e,t,n){"use strict";var a=n(57437),s=n(81628);function DefEmpty(){return(0,a.jsx)("tr",{className:"text-lg font-normal text-center text-black ",children:(0,a.jsx)("td",{colSpan:100,className:"h-[100px] py-5 align-top"})})}n(2265),t.ZP=e=>{let{header:t,data:n,span:r={},empty:i=(0,a.jsx)(DefEmpty,{}),className:l="relative min-w-full bg-transparent ",headerClassName:o,headerItemClassName:c,tbodyClassName:d="",rowClassName:u,rowStyle:m,cellClassName:x,onClickRow:h,onRowMouseHover:p}=e;return(0,a.jsxs)("table",{className:(0,s.cn)("relative min-w-full bg-transparent ",l),children:[(0,a.jsx)("thead",{className:"",children:(0,a.jsx)("tr",{className:(0,s.cn)("text-left whitespace-nowrap font-normal text-black border-b border-gray-100 pt-5 pb-6",o),children:t.map((e,t)=>(0,a.jsx)("th",{colSpan:r[t],scope:"col",className:(0,s.cn)(0==r[t]?"p-0 w-0":"p-3 font-normal text-sm",c),children:e},t))})}),(0,a.jsxs)("tbody",{className:(0,s.cn)(d),children:[n.map((e,n)=>(0,a.jsx)("tr",{onClick:()=>h&&h(n),onMouseEnter:()=>p&&p(n),onMouseLeave:()=>p&&p(-1),style:"function"==typeof m?m(n):m,className:(0,s.cn)("text-slate-700 font-medium whitespace-nowrap",h?"cursor-pointer hover:bg-slate-400/10":"","function"==typeof u?u(n):u),children:e.map((e,i)=>i>=t.length?(0,a.jsx)(a.Fragment,{children:e}):(0,a.jsx)("td",{colSpan:r[i],className:(0,s.cn)(0==r[i]?"p-0 w-max":"px-3 py-2 text-sm w-max","function"==typeof x?x(n,i):x),children:e},i))},n)),0===n.length&&i]})]})}},51549:function(e,t,n){"use strict";n.d(t,{c:function(){return CoinIcon}});var a=n(57437);function CoinIcon(e){let{symbol:t,size:n=48,...s}=e;return(0,a.jsx)("img",{...s,width:n,height:n,src:"/".concat(t,".svg"),alt:t})}},63040:function(e,t,n){"use strict";n.d(t,{a:function(){return MigrationTip}});var a=n(57437),s=n(73479),r=n(72009),i=n(14389),l=n(54415),o=n(81628),c=n(20373),d=n(24033),u=n(2265),m=n(58910),x=n(89348),h=n(46246),p=n(56926),f=n(7935),g=n(93390),b=n(51549),j=n(28712),N=n(52410);function SimpleDialog(e){let{trigger:t,children:n,className:s,style:r,closeClassName:i,disableOutClose:l,disableClose:c,...d}=e;return(0,a.jsxs)(j.fC,{...d,children:[(0,a.jsx)(j.xz,{children:t}),(0,a.jsxs)(j.h_,{children:[(0,a.jsx)(j.aV,{className:"fixed top-0 left-0 inset-0 z-50 bg-black/60"}),(0,a.jsxs)(j.VY,{onEscapeKeyDown:e=>{c&&e.stopPropagation(),c&&e.preventDefault()},onInteractOutside:e=>{console.info("e:",e),l&&e.stopPropagation(),l&&e.preventDefault()},style:r,className:(0,o.cn)("fixed top-[50%] left-[50%] max-h-[85vh] w-[90vw] max-w-[640px] -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl overflow-hidden shadow-2xl z-50",s),children:[n,(0,a.jsx)(j.x8,{disabled:c,className:(0,o.cn)("absolute right-4 top-4 cursor-point text-xl",i),children:(0,a.jsx)(N.abH,{})})]})]})]})}var v=n(72084);function MarginLoan(e){let{symbol:t,value:n}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 pr-8",children:[(0,a.jsx)(b.c,{symbol:t,size:20}),(0,a.jsx)("span",{children:(0,c.dq)(n)})]})}function MigrationV2(){let e=(0,i.p)(),t=r.Lh[e][0],n=r.Lh[e][1],x=r.iK[e][0],b=r.iK[e][1],[j,N]=(0,h.Z)(!1),{address:y}=(0,p.mA)(),{data:k,isFetching:w}=function(e){let t=(0,i.p)(),{address:n}=(0,p.mA)(),a=r.Lh[t][0],c=r.Lh[t][1],d=(0,l.uT)(),queryFn=async()=>{let e=await Promise.all([{abi:f.em,address:a.xTokenAddress,functionName:"balanceOf",args:[n]},{abi:f.em,address:c.xTokenAddress,functionName:"balanceOf",args:[n]},{abi:s.aT,address:a.ptyPoolAboveAddress,functionName:"userStakingBalance",args:[n]},{abi:s.aT,address:a.ptyPoolBelowAddress,functionName:"userStakingBalance",args:[n]},{abi:f.em,address:r.O1[t],functionName:"balanceOf",args:[n]},{abi:f.em,address:a.xTokenAddress,functionName:"totalSupply"},{abi:s.WW,address:a.vault,functionName:"usbTotalSupply"},{abi:s.aT,address:a.ptyPoolBelowAddress,functionName:"earnedStakingYields",args:[n]}].map(e=>d(e))),i=(0,o.Rj)(e,[7],0n,1000n),l=(0,o.Rj)(e,[0],0n,1000n),u=l+i,m=(0,o.Rj)(e,[1],0n,1000n),x=(0,o.Rj)(e,[2],0n,1000n),h=(0,o.Rj)(e,[3],0n,1000n),p=(0,o.ok)(e,[4]),g=(0,o.ok)(e,[5]),b=(0,o.ok)(e,[6]),j=await Promise.all([l?d({abi:s.Wn,address:r.O6[t],functionName:"calcPairedRedeemAssetAmount",args:[a.vault,l]}).then(e=>e[1]):0n,m?d({abi:s.Wn,address:r.O6[t],functionName:"calcRedeemByMarginTokensFromStableVault",args:[c.vault,r.e_[t],m]}).then(e=>e[2]):0n]),N=l?(0,o.ok)(j,[0]):0n,v=m?(0,o.ok)(j,[1]):0n;return{earnEthx:i,ethxBalance:l,ethxTotal:u,usdbxBalance:m,ethStaked:x,usbStaked:h,usbBalance:p,usbTotal:p+h,ethxMarginloan:g>0n?-(u*b)/g:0n,ethOutAmount:N,usdbOutAmount:v}};return(0,p.aM)([t,n,e],{queryFn,retry:!0,initialData:(0,o.Yb)({},0n),cacheTime:1e3})}(j),S=k.usbTotal+k.ethxMarginloan<0n,B=k.ethxTotal+k.usdbxBalance+k.ethStaked<=0n,{mutateAsync:T,isLoading:A,finishCount:M,reset:V}=(0,l.Lh)(),O=Object.values(k).toString(),P=(0,u.useMemo)(()=>{let e=[];return k.usbStaked?e.push({name:"Withdraw USB from V1 Earn Pool",abi:s.aT,address:t.ptyPoolBelowAddress,functionName:"exit"}):k.earnEthx&&e.push({name:"Withdraw USB from V1 Earn Pool",abi:s.aT,address:t.ptyPoolBelowAddress,functionName:"claimAll"}),k.ethStaked&&e.push({name:"Withdraw ETH from V1 Earn Pool",abi:s.aT,address:t.ptyPoolAboveAddress,functionName:"exit"}),k.ethxTotal&&e.push({name:"Redeem ETH from V1 Vault",abi:s.WW,address:t.vault,functionName:"redeemByPairsWithExpectedMarginTokenAmount",args:[k.ethxTotal]}),k.ethOutAmount&&e.push({name:"Deposit ETH to V2 Vault",abi:s.WW,address:x.vault,functionName:"mintPairs",args:[k.ethOutAmount],value:k.ethOutAmount}),k.usdbxBalance&&e.push({name:"Redeem USDB from V1 Vault",abi:s.S4,address:n.vault,functionName:"redeemByMarginTokens",args:[k.usdbxBalance]}),k.usdbOutAmount&&e.push({name:"Deposit USDB to V2 Vault",abi:s.S4,address:b.vault,functionName:"mintMarginTokens",args:[k.usdbOutAmount],prepare:async(e,t)=>{let n=await t.readContract({abi:f.em,address:b.assetTokenAddress,functionName:"balanceOf",args:[y]});return{...e,args:[n<k.usdbOutAmount?n:k.usdbOutAmount]}}}),e},[O,t,x,n,b]);(0,u.useEffect)(()=>{V()},[O]);let C=M==P.length,E=(0,u.useRef)(null),migrate=async()=>{try{var e;if(C)return null===(e=E.current)||void 0===e?void 0:e.click();if(B)return;console.info("tasks:",P),await T(P)}catch(e){(0,o.S3)(e)}},W=(0,d.useRouter)(),D=(0,d.usePathname)();return(0,a.jsx)(SimpleDialog,{disableOutClose:!0,style:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.8) 0%, rgba(228, 228, 228, 0.8) 50.49%, rgba(255, 255, 255, 0.8) 100%)"},open:j,onOpenChange:N,className:"backdrop-blur-lg max-w-[800px]",disableClose:A,trigger:(0,a.jsx)("button",{className:"btn-primary mt-0",ref:E,children:"MIGRATION TO V2"}),children:(0,a.jsxs)("div",{className:"card flex flex-col gap-4 !bg-transparent",children:[(0,a.jsx)("div",{className:"page-sub text-left",children:"MIGRATION TO V2"}),(0,a.jsx)("div",{children:"Before migration, make sure your USB balance is greater than your margin loan."}),w?(0,a.jsx)("div",{className:"flex justify-center items-center h-[357px]",children:(0,a.jsx)(v.$,{})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[(0,a.jsx)("div",{className:"rounded-lg overflow-x-auto w-full bg-zinc-200 pb-2",children:(0,a.jsx)(g.ZP,{header:["","Balance","Margin loan"],data:[["ETHx-V1",(0,c.dq)(k.ethxTotal),(0,a.jsx)(MarginLoan,{symbol:"USB",value:k.ethxMarginloan},"ethx_ml")],["USDBx-V1",(0,c.dq)(k.usdbxBalance),""],["ETH-V1",(0,c.dq)(k.ethStaked),""],["USB",(0,c.dq)(k.usbTotal),""]]})}),(0,a.jsxs)("div",{className:"flex flex-col pl-3 pt-5 gap-1 md:pl-5 md:pt-2",children:[(0,a.jsx)("div",{className:"text-lg",children:"Progress"}),P.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{children:["- ",e.name]}),t<M&&(0,a.jsx)(m.ZSR,{className:"text-green-500"}),A&&t==M&&(0,a.jsx)(v.$,{})]},"task_"+t))]})]}),(0,a.jsxs)("button",{className:"btn-primary flex items-center gap-2 justify-center",disabled:S||A||w,onClick:migrate,children:[A&&(0,a.jsx)(v.$,{}),C&&(0,a.jsx)(m.ZSR,{className:"text-green-500"}),A?"Migrating":M==P.length?"Completed":"Start to Migration"]}),S&&(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("span",{children:"USB balance is insufficient. "}),(0,a.jsx)("span",{children:"Mint more USB from the"})," ",(0,a.jsx)("button",{className:"underline text-indigo-500 outline-none inline-block",onClick:()=>{var e;if("/vaults"==D)return null===(e=E.current)||void 0===e?void 0:e.click();W.push("/vaults")},children:"USDB V2 Vault"})]})]})]})})}function MigrationTip(){let e=(0,i.p)(),t=r.Lh[e],n=t&&t.length>0;return n?(0,a.jsxs)("div",{className:"flex flex-col justify-center gap-4 items-center md:flex-row",children:[(0,a.jsxs)("div",{className:"text-sm text-red-500 p-2 rounded bg-[#FFE5E0] flex items-center gap-2",children:[(0,a.jsx)("div",{className:"p-1 rounded bg-red-500",children:(0,a.jsx)(x._sk,{className:"text-white"})}),"Wand has been updated to Version2. Please ensure you complete the migration of your assets promptly."]}),(0,a.jsx)(MigrationV2,{})]}):null}},72084:function(e,t,n){"use strict";n.d(t,{$:function(){return Spinner}});var a=n(57437),s=n(57042);let Spinner=e=>{let{className:t}=e;return(0,a.jsxs)("svg",{fill:"none",className:(0,s.Z)(t,"animate-spin h-5 w-5 2-ml-1 2mr-3"),viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},64020:function(e,t,n){"use strict";n.d(t,{C:function(){return Tip}});var a=n(57437),s=n(81628),r=n(75224),i=n(40311);function Tip(e){let{children:t,node:n,className:l,inFlex:o}=e,c=document.getElementById("tooltip-root");return t?(0,a.jsx)(r.zt,{children:(0,a.jsxs)(r.fC,{children:[(0,a.jsx)(r.xz,{asChild:!0,children:n?(0,a.jsx)("div",{className:(0,s.cn)("inline-block cursor-default",l),style:{verticalAlign:"text-bottom"},children:n}):(0,a.jsx)("div",{className:(0,s.cn)(o?"flex":"translate-y-[-6%] inline-block"," px-[3px] cursor-default relative",l),children:(0,a.jsx)(i.apP,{className:"inline-block stroke-slate-500"})})}),(0,a.jsx)(r.h_,{container:c,children:(0,a.jsxs)(r.VY,{className:"max-w-xs text-sm text-white bg-slate-900 rounded-md p-4",children:[t,(0,a.jsx)(r.Eh,{})]})})]})}):n}},20373:function(e,t,n){"use strict";n.d(t,{Rp:function(){return displayBalanceWithUnit},ZM:function(){return displayBalanceWithoutFormat},dq:function(){return displayBalance}});var a=n(16775),s=n(79352);let displayBalanceWithUnit=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2?arguments[2]:void 0;if(!e)return"0";let s=10**t,r=Math.floor(Number((0,a.b)(e,n))*s)/s,i=Number((.1**t).toFixed(t));return r>0&&r<i?"<"+i:r<0&&r>-i?"≈0":r.toLocaleString("en-US",{maximumFractionDigits:t})},displayBalance=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return"0";let n=Number((0,s.d)(e)),a=Number((.1**t).toFixed(t));return n>0&&n<a?"<"+a:n<0&&n>-a?"≈0":n.toLocaleString("en-US",{maximumFractionDigits:t})},displayBalanceWithoutFormat=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return"0";let n=10**t,a=Math.floor(Number((0,s.d)(e))*n)/n,r=Number((.1**t).toFixed(t));return a>0&&a<r?"<"+r:a<0&&a>-r?"≈0":String(a)}}}]);