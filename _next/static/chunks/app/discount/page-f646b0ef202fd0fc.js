(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2143],{43949:function(e,s,t){Promise.resolve().then(t.bind(t,40358))},40358:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return DiscountPage}});var a=t(31113),l=t(99548),n=t(91214),r=t(33621),i=t(26504),d=t(19757),c=t(22139),o=t(59175),x=t(15506),m=t(26361),u=t(75930),f=t(84944),h=t(41690),p=t.n(h),g=t(64103),b=t(39341),v=t(88501);let ValutArea=e=>{let{asset:s}=e,{vaultsState:t,stableVaultsState:l,vaultsDiscount:n}=(0,g.useContext)(u.g),i=(0,o.p)(),c=d.iK[i],x=c.find(e=>e.assetTokenSymbol==s),f=x.assetTokenSymbol,h=n[x.vault],p=h?"Discount available":"No discount",b=!h,A=t[x.vault],j=l[x.vault],{rate:w}=useDiscountRate(x),[N,k]=(0,g.useMemo)(()=>{if(x.isStable){if(!j)return["50%","50%"];let toPercent=e=>(100*Math.max(0,Math.min(1,(e-1)/1))).toFixed(2)+"%",e=(0,m.pF)(j.AARS,j.AARDecimals),s=(0,m.pF)(j.aar,j.AARDecimals);return[toPercent(s),toPercent(e)]}{if(!A)return["50%","50%"];let e=(0,m.pF)(A.AARU,A.AARDecimals),s=(0,m.pF)(A.aar,A.AARDecimals),t=(0,m.pF)(A.AARS,A.AARDecimals),a=(0,m.pF)(A.AART,A.AARDecimals),l=e/2,toPercent=s=>(100*Math.max(0,Math.min(1,(s-l)/(e-l)))).toFixed(2)+"%",n=toPercent(s);return b?[n,toPercent(t)]:[n,toPercent(a)]}},[x.isStable,A.AARU,A.aar,A.AARS,A.AART,j.AARS,j.aar,b]),R=x.isStable?(0,m.Rr)(j.aar,j.AARDecimals):(0,m.Rr)(A.aar,A.AARDecimals),S=x.isStable?(0,m.Rr)(j.AARS,j.AARDecimals):b?(0,m.Rr)(A.AARS,A.AARDecimals):(0,m.Rr)(A.AART,A.AARDecimals),D=(0,a.jsxs)("div",{style:{position:"relative",left:N,transform:"translate(-50%,0)"},className:"flex flex-col items-center w-fit rounded-md",children:[(0,a.jsxs)("div",{className:"text-xs flex flex-col justify-center items-center p-1.5 px-4",children:[(0,a.jsx)("span",{className:"text-neutral-400 whitespace-nowrap",children:"Current AAR"}),(0,a.jsx)("span",{className:"font-medium dark:text-violet-300",children:R})]}),(0,a.jsx)("svg",{width:"10",height:"8",viewBox:"0 0 10 8",xmlns:"http://www.w3.org/2000/svg",className:"fill-slate-950 dark:fill-slate-50",fill:"currentColor",children:(0,a.jsx)("path",{d:"M5 7.5L0.669873 -7.57104e-07L9.33013 0L5 7.5Z"})})]}),T=(0,a.jsxs)("div",{style:{position:"relative",left:k,transform:"translate(-50%,0)"},className:"flex flex-col items-center w-fit rounded-md",children:[(0,a.jsx)("svg",{className:"rotate-180",width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M5 7.5L0.669873 -7.57104e-07L9.33013 0L5 7.5Z",fill:b?"#E83B3B":"#54E83B"})}),(0,a.jsxs)("div",{className:"text-xs flex flex-col justify-center items-center p-1.5 px-4",children:[(0,a.jsxs)("span",{className:"font-medium dark:text-violet-300",children:["AAR=",S]}),(0,a.jsx)("span",{className:"text-neutral-400 whitespace-nowrap",children:b?"Trigger discount":"Discount end"})]})]});return(0,a.jsxs)("div",{className:"bg-white border border-neutral-200 rounded-3xl flex flex-col items-center mb-4 md:flex-row p-4 w-full md:mb-[30px] dark:bg-transparent dark:border-zinc-600",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center h-fit gap-4",children:[(0,a.jsxs)("div",{className:"md:w-[180px] flex items-center",children:[(0,a.jsx)(r.c,{symbol:x.assetTokenSymbol,size:32,className:"mr-[10px] md:hidden"}),(0,a.jsx)(r.c,{symbol:x.assetTokenSymbol,size:54,className:"mr-[10px] hidden md:block"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-md md:text-xl font-bold",children:[f," Vault"]}),(0,a.jsx)("div",{className:"text-xs flex items-center gap-2",children:!h&&(0,a.jsxs)("div",{className:"flex items-center text-neutral-700 dark:text-slate-50 gap-1",children:[(0,a.jsx)("div",{className:(0,v.m)("w-3 h-3 shrink-0 rounded-full",h?"bg-red-500":"bg-green-500")}),p]})})]})]}),h&&(0,a.jsxs)("div",{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)("div",{className:(0,v.m)("w-3 h-3 shrink-0 rounded-full bg-red-500")})," Discount Rate: ",w]})]}),(0,a.jsxs)("div",{className:"w-full md:w-[calc(100%-170px)] p-4 rounded-lg flex flex-col gap-2",children:[D,(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"rounded-full shrink-0 w-[3px] h-[3px] bg-[#64748B] dark:bg-violet-300"}),(0,a.jsx)("div",{className:"h-px flex-1 bg-[#64748B] dark:bg-violet-300 after:content-['AAR'] after:inline-block after:text-right after:w-full after:text-xs after:text-[#64748B] dark:after:text-slate-50"}),(0,a.jsx)("div",{className:"rounded-full shrink-0 w-[3px] h-[3px] bg-[#64748B] dark:bg-violet-300"})]}),T]})]})};function useDiscountRate(e){let{prices:s}=(0,g.useContext)(u.g),t=(0,o.p)(),{data:a}=(0,x.D2)({abi:i.Wn,address:d.O6[t],functionName:e.isStable?"calcUsbToMarginTokensForStableVault":"calcUsbToMarginTokens",args:[e.vault,d.e_[t],(0,m.su)("1")]}),l=(0,m.ok)(a,[1]),n=(0,g.useMemo)(()=>0n==l?0n:(0,m.su)("1")*c.Pq/l,[l]),r=(0,g.useMemo)(()=>{let t=s[e.xTokenAddress];return!t||0n==t||0n==n||n>=t?"0.00%":(0,m.Jh)((t-n)*c.Pq/t,18,2)},[s[e.xTokenAddress],n]);return{rate:r,oneUsbXoutValue:l}}function DiscountPage(){let{balances:e,prices:s,vaultsDiscount:t}=(0,g.useContext)(u.g),r=(0,o.p)(),x=(0,g.useMemo)(()=>d.iK[r].filter(e=>!e.disableIn),[r]),h=(0,g.useMemo)(()=>x.map(e=>({value:e.vault,label:e.xTokenSymbol})),[x]),[v,A]=(0,g.useState)(h[0]),j=h.find(e=>e===v)?v:h[0],w=x.find(e=>e.vault==j.value),N=t[w.vault],k=(0,m.ok)(s,w.xTokenAddress),R=e[d.O1[r]],[S,D]=(0,g.useState)(""),T=(0,m.su)(S),y=0n!=T&&T<=R&&N,{rate:P,oneUsbXoutValue:M}=useDiscountRate(w),B=M*T/c.Pq;return(0,a.jsxs)("div",{className:"mx-auto max-w-screen-lg p-4",children:[(0,a.jsxs)("div",{className:"bg-indigo-50 dark:bg-s1 p-6 mt-[30px] rounded-3xl relative",children:[(0,a.jsx)("h3",{className:"text-indigo-500 dark:text-slate-50 font-medium text-xl",children:"Discount Offer"}),(0,a.jsxs)("p",{className:"text-indigo-900 dark:text-slate-50/80 mt-4",children:[(0,a.jsx)(p(),{src:"/discount.png",style:{shapeOutside:"circle(39% at 64% -38%)"},width:300,height:204,className:"float-right -mt-[130px] -mr-20",alt:""}),"Due to fluctuations in the prices of underlying assets, when the AAR decreases, the protocol will offer users the opportunity to purchase xToken at a discount with $USB. This means that you can engage in arbitrage."]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 mt-5 gap-2 md:grid-cols-2 md:gap-4 md:gap-8 md:mt-8 md:p-6",children:[(0,a.jsx)("div",{className:"w-full",children:x.map(e=>(0,a.jsx)(ValutArea,{asset:e.assetTokenSymbol},"vault_area_".concat(e.assetTokenSymbol)))}),(0,a.jsxs)("div",{className:"w-full bg-white border border-neutral-200 p-4 mb-4 md:p-[30px] md:pt-[60px] rounded-3xl md:mb-[30px] dark:bg-transparent dark:border-zinc-600",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full mx-auto",children:[(0,a.jsx)(n.W,{asset:"USB",amount:S,setAmount:D,balance:R,exchange:(0,f.dq)(T*(0,m.ok)(s,d.O1[r],c.Pq)/c.Pq)}),(0,a.jsxs)("div",{className:"flex items-center justify-center w-full",children:[(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)(b.gPZ,{className:"w-6 h-6 text-neutral-500  border border-neutral-200 rounded-full my-[10px]"}),(0,a.jsx)("div",{className:"flex-1"})]}),(0,a.jsxs)("div",{className:"w-full flex-1 text-right text-neutral-700 dark:text-slate-50/60 text-md whitespace-nowrap",children:["Discount Rate: ",N?P:"--"]}),(0,a.jsx)(n.W,{asset:j.label,amount:(0,f.dq)(B),exchange:(0,f.dq)(k*B/c.Pq),readonly:!0,hasInput:!0,options:h,defaultValue:h[0],onChange:e=>{console.log(e),A(e)}})]}),(0,a.jsx)(l.v,{tx:"Swap",disabled:!y,onTxSuccess:()=>{D("")},config:{abi:i.WW,address:w.vault,functionName:"usbToMarginTokens",args:[T],enabled:y},approves:{[d.O1[r]]:T},spender:w.vault})]})]})]})}}},function(e){e.O(0,[7495,4643,7588,4775,4659,8836,1996,2845,7869,1690,5166,1578,7638,1346,7093,604,1744],function(){return e(e.s=43949)}),_N_E=e.O()}]);